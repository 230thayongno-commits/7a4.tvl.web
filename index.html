<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>7A4 GALAXY COMMAND</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#060912;
      --bg2:#0b1230;
      --card:rgba(255,255,255,0.06);
      --card2:rgba(255,255,255,0.09);
      --stroke:rgba(255,255,255,0.12);
      --txt:#eaf1ff;
      --muted:rgba(234,241,255,0.7);
      --accent:#7c5cff;
      --accent2:#00e5ff;
      --danger:#ff4d6d;
      --good:#2cffb3;
      --shadow: 0 18px 50px rgba(0,0,0,0.35);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--txt);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,0.25), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(0,229,255,0.18), transparent 55%),
        linear-gradient(160deg,var(--bg1),var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    header{
      position:sticky;
      top:0;
      z-index:50;
      padding:18px 18px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.55), rgba(0,0,0,0));
      backdrop-filter: blur(10px);
    }

    .topbar{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.55), transparent 50%),
        linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow: var(--shadow);
    }
    .brand h1{
      font-size:1.05rem;
      margin:0;
      letter-spacing:0.5px;
      font-weight:800;
      text-transform:uppercase;
    }
    .brand p{
      margin:2px 0 0;
      font-size:0.78rem;
      color:var(--muted);
      font-weight:600;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
    }
    button{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,0.07);
      color:var(--txt);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      transition: transform .15s ease, background .15s ease, border .15s ease;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.11); }
    button.primary{
      border: none;
      background: linear-gradient(135deg,var(--accent),var(--accent2));
      color:#071024;
      box-shadow: 0 14px 30px rgba(124,92,255,0.28);
    }
    button.danger{
      border: none;
      background: linear-gradient(135deg,var(--danger),#ff9a3d);
      color:#140308;
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding: 12px 18px 80px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.3fr 0.7fr;
      gap:16px;
      align-items:start;
    }

    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-header{
      padding:16px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card-header h2{
      margin:0;
      font-size:1.02rem;
      font-weight:800;
    }
    .card-header small{
      color:var(--muted);
      font-weight:700;
    }
    .card-body{ padding:16px; }

    .teams{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .team{
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      position:relative;
      overflow:hidden;
    }
    .team:before{
      content:"";
      position:absolute; inset:-40px -40px auto auto;
      width:160px;height:160px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(124,92,255,0.45), transparent 65%);
      filter: blur(2px);
      opacity:0.7;
      pointer-events:none;
    }
    .team h3{
      margin:0 0 6px;
      font-size:1rem;
      font-weight:900;
    }
    .score{
      display:flex;
      align-items:baseline;
      gap:10px;
    }
    .score span.value{
      font-size:2.2rem;
      font-weight:900;
      letter-spacing:0.5px;
    }
    .score span.unit{
      color:var(--muted);
      font-weight:800;
      font-size:0.9rem;
    }
    .controls{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .controls button{
      padding:9px 12px;
      border-radius:14px;
      font-weight:900;
    }

    .mini{
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
    }
    .item b{font-weight:900}
    .item small{color:var(--muted); font-weight:700}

    /* ===== Admin Panel ===== */
    #admin-panel{
      position:fixed;
      right:18px;
      top:88px;
      width: 320px;
      z-index:100;
      border-radius:22px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.72);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding:14px;
      display:none;
    }
    #admin-panel h4{
      margin:0 0 10px;
      font-size:1rem;
      font-weight:900;
    }
    #admin-panel .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    #admin-panel .row button{
      flex:1;
      min-width:120px;
      padding:10px 12px;
    }

    /* ===== Mobile ===== */
    @media (max-width: 900px){
      .grid{ grid-template-columns:1fr; }
    }
    @media (max-width: 600px){
      header{ padding:14px; }
      main{ padding: 10px 14px 90px; }
      .logo{ width:40px; height:40px; border-radius:14px; }
      .teams{ grid-template-columns:1fr; }

      #admin-panel{
        left: 50%;
        right: auto;
        top: auto;
        bottom: 18px;
        transform: translateX(-50%);
        width: calc(100% - 28px);
        max-width: 440px;
      }
    }
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>7A4 Galaxy Command</h1>
        <p>Realtime ƒëi·ªÉm t·ªï + Admin</p>
      </div>
    </div>

    <div class="actions">
      <button id="admin-btn" class="primary" onclick="galaxy.toggleAdminPrompt()">Admin</button>
      <button class="danger" onclick="galaxy.logout()">Tho√°t</button>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- Left: Teams -->
    <section class="card">
      <div class="card-header">
        <h2>üìä B·∫£ng ƒëi·ªÉm t·ªï (Realtime)</h2>
        <small id="sync-status">ƒêang k·∫øt n·ªëi‚Ä¶</small>
      </div>

      <div class="card-body">
        <div class="teams">

          <div class="team">
            <h3>T·ªï 1</h3>
            <div class="score">
              <span class="value" id="score_to1">0</span>
              <span class="unit">ƒëi·ªÉm</span>
            </div>
            <div class="controls">
              <button onclick="galaxy.adjust('to1', +1)">+1</button>
              <button onclick="galaxy.adjust('to1', -1)">-1</button>
              <button onclick="galaxy.adjust('to1', +5)">+5</button>
              <button onclick="galaxy.adjust('to1', -5)">-5</button>
            </div>
          </div>

          <div class="team">
            <h3>T·ªï 2</h3>
            <div class="score">
              <span class="value" id="score_to2">0</span>
              <span class="unit">ƒëi·ªÉm</span>
            </div>
            <div class="controls">
              <button onclick="galaxy.adjust('to2', +1)">+1</button>
              <button onclick="galaxy.adjust('to2', -1)">-1</button>
              <button onclick="galaxy.adjust('to2', +5)">+5</button>
              <button onclick="galaxy.adjust('to2', -5)">-5</button>
            </div>
          </div>

          <div class="team">
            <h3>T·ªï 3</h3>
            <div class="score">
              <span class="value" id="score_to3">0</span>
              <span class="unit">ƒëi·ªÉm</span>
            </div>
            <div class="controls">
              <button onclick="galaxy.adjust('to3', +1)">+1</button>
              <button onclick="galaxy.adjust('to3', -1)">-1</button>
              <button onclick="galaxy.adjust('to3', +5)">+5</button>
              <button onclick="galaxy.adjust('to3', -5)">-5</button>
            </div>
          </div>

          <div class="team">
            <h3>T·ªï 4</h3>
            <div class="score">
              <span class="value" id="score_to4">0</span>
              <span class="unit">ƒëi·ªÉm</span>
            </div>
            <div class="controls">
              <button onclick="galaxy.adjust('to4', +1)">+1</button>
              <button onclick="galaxy.adjust('to4', -1)">-1</button>
              <button onclick="galaxy.adjust('to4', +5)">+5</button>
              <button onclick="galaxy.adjust('to4', -5)">-5</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Right: Info -->
    <aside class="mini">
      <section class="card">
        <div class="card-header">
          <h2>‚ö° Tr·∫°ng th√°i</h2>
          <small>Firebase Firestore</small>
        </div>
        <div class="card-body">
          <div class="list">
            <div class="item">
              <div>
                <b>Admin mode</b><br>
                <small id="admin-state">OFF</small>
              </div>
              <button onclick="galaxy.toggleAdminPrompt()">M·ªü</button>
            </div>

            <div class="item">
              <div>
                <b>ƒê·ªìng b·ªô</b><br>
                <small>Realtime</small>
              </div>
              <button onclick="galaxy.forceRefresh()">Refresh</button>
            </div>

            <div class="item">
              <div>
                <b>Reset</b><br>
                <small>V·ªÅ 0 (Admin)</small>
              </div>
              <button class="danger" onclick="galaxy.resetAll()">Reset</button>
            </div>
          </div>
        </div>
      </section>
    </aside>

  </div>
</main>

<!-- Admin Panel -->
<div id="admin-panel">
  <h4>üîê Admin Panel</h4>
  <div class="row">
    <button onclick="galaxy.resetAll()">Reset t·∫•t c·∫£</button>
    <button onclick="galaxy.toggleAdmin(false)">T·∫Øt admin</button>
  </div>
</div>

<!-- ===== Firebase + App Logic ===== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    updateDoc,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  // ===== Firebase config (c·ªßa b·∫°n) =====
  const firebaseConfig = {
    apiKey: "AIzaSyBtdoU4bzBVsXXvYswbUf0smAuYIq9rxlM",
    authDomain: "a4-galaxy-command.firebaseapp.com",
    projectId: "a4-galaxy-command",
    storageBucket: "a4-galaxy-command.firebasestorage.app",
    messagingSenderId: "147400399283",
    appId: "1:147400399283:web:6d470d3e02a94e01f053c6",
    measurementId: "G-678SMH2ND5"
  };

  // Init Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const $ = (id) => document.getElementById(id);

  const state = {
    admin: false,
    adminPass: "7A4", // ƒë·ªïi m·∫≠t kh·∫©u admin t·∫°i ƒë√¢y
    connected: false
  };

  function setSyncStatus(text){
    const el = $("sync-status");
    if (el) el.textContent = text;
  }

  function setAdminUI(){
    $("admin-state").textContent = state.admin ? "ON" : "OFF";
    $("admin-state").style.color = state.admin ? "var(--good)" : "var(--muted)";
    $("admin-panel").style.display = state.admin ? "block" : "none";
  }

  async function ensureTeam(teamId, nameText){
    const ref = doc(db, "teams", teamId);
    const snap = await getDoc(ref);
    if (!snap.exists()){
      await setDoc(ref, {
        name: nameText,
        score: 0,
        updatedAt: Date.now()
      });
    }
  }

  async function adjustScore(teamId, delta){
    if (!state.admin){
      alert("B·∫°n ch∆∞a b·∫≠t Admin!");
      return;
    }
    const ref = doc(db, "teams", teamId);
    const snap = await getDoc(ref);

    if (!snap.exists()){
      await setDoc(ref, {
        name: teamId,
        score: 0,
        updatedAt: Date.now()
      });
    }

    const snap2 = await getDoc(ref);
    const current = snap2.data()?.score ?? 0;
    const newScore = current + delta;

    await updateDoc(ref, {
      score: newScore,
      updatedAt: Date.now()
    });
  }

  function listenTeam(teamId, elementId){
    const ref = doc(db, "teams", teamId);
    onSnapshot(ref, (snap) => {
      if (!snap.exists()) return;
      state.connected = true;
      setSyncStatus("ƒê√£ k·∫øt n·ªëi ‚úì");

      const score = snap.data()?.score ?? 0;
      const el = $(elementId);
      if (el) el.textContent = score;
    }, (err)=>{
      console.error(err);
      setSyncStatus("L·ªói k·∫øt n·ªëi!");
    });
  }

  async function resetAllScores(){
    if (!state.admin){
      alert("Ch·ªâ Admin m·ªõi reset ƒë∆∞·ª£c!");
      return;
    }
    if (!confirm("Reset t·∫•t c·∫£ ƒëi·ªÉm v·ªÅ 0?")) return;

    const teams = ["to1","to2","to3","to4"];
    for (const t of teams){
      const ref = doc(db, "teams", t);
      await updateDoc(ref, { score: 0, updatedAt: Date.now() });
    }
    alert("ƒê√£ reset ƒëi·ªÉm!");
  }

  // ===== Galaxy object (onclick s·∫Ω g·ªçi) =====
  const galaxy = {
    logout(){
      alert("ƒê√£ tho√°t (demo). N·∫øu b·∫°n mu·ªën, m√¨nh s·∫Ω n·ªëi logout th·∫≠t b·∫±ng Firebase Auth.");
      // window.location.href = "index.html";
    },

    forceRefresh(){
      alert("Realtime t·ª± c·∫≠p nh·∫≠t r·ªìi üòÑ N·∫øu mu·ªën refresh c·ª©ng: F5");
    },

    toggleAdminPrompt(){
      if (state.admin){
        galaxy.toggleAdmin(false);
        return;
      }
      const pass = prompt("Nh·∫≠p m·∫≠t kh·∫©u Admin:");
      if (pass === null) return;
      if (pass.trim() === state.adminPass){
        galaxy.toggleAdmin(true);
      } else {
        alert("Sai m·∫≠t kh·∫©u!");
      }
    },

    toggleAdmin(on){
      state.admin = !!on;
      setAdminUI();
    },

    adjust(teamId, delta){
      adjustScore(teamId, delta);
    },

    resetAll(){
      resetAllScores();
    }
  };

  // ===== FULL FIX quan tr·ªçng: expose global =====
  // (n·∫øu kh√¥ng c√≥ d√≤ng n√†y th√¨ onclick="galaxy...." s·∫Ω kh√¥ng ch·∫°y)
  window.galaxy = galaxy;

  // ===== Init =====
  (async ()=>{
    setSyncStatus("ƒêang k·∫øt n·ªëi‚Ä¶");
    setAdminUI();

    await ensureTeam("to1", "T·ªï 1");
    await ensureTeam("to2", "T·ªï 2");
    await ensureTeam("to3", "T·ªï 3");
    await ensureTeam("to4", "T·ªï 4");

    listenTeam("to1", "score_to1");
    listenTeam("to2", "score_to2");
    listenTeam("to3", "score_to3");
    listenTeam("to4", "score_to4");

    setTimeout(()=>{
      if (!state.connected) setSyncStatus("Ch∆∞a c√≥ ph·∫£n h·ªìi‚Ä¶");
    }, 2500);
  })();
</script>

</body>
</html>
